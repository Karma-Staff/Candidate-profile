{% extends "base.html" %}

{% block content %}
<style>
    .activity-icon-box[data-category="view"] {
        background: var(--accent-subtle);
        color: var(--accent);
    }

    .activity-icon-box[data-category="login"] {
        background: var(--success-subtle);
        color: var(--success);
    }

    .activity-icon-box[data-category="logout"] {
        background: var(--warning-subtle);
        color: var(--warning);
    }

    .activity-icon-box[data-category="other"] {
        background: var(--danger-subtle);
        color: var(--danger);
    }
</style>

<div class="page-header">
    <div style="display: flex; align-items: center; gap: 0.875rem; margin-bottom: 0.5rem;">
        <div
            style="width: 44px; height: 44px; background: linear-gradient(135deg, var(--accent), #818cf8); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
            <i data-lucide="layout-dashboard" style="width: 22px; height: 22px; color: white;"></i>
        </div>
        <h1 style="margin: 0;">{% if user.role == 'client' %}My Dashboard{% else %}Admin Dashboard{% endif %}</h1>
    </div>
    <p>{% if user.role == 'client' %}Track your recent activity and interactions{% else %}Monitor system activity,
        users, and audit logs{% endif %}</p>
</div>

<!-- Stats Row -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 1.25rem; margin-bottom: 2.5rem;"
    class="animate-in delay-1">
    <div class="card stat-card accent">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <div class="stat-label">{% if user.role == 'client' %}My Recent Activity{% else %}Total Audit Logs{%
                    endif %}</div>
                <div class="stat-value">{{ total_logs }}</div>
            </div>
            <div
                style="width: 44px; height: 44px; background: var(--accent-subtle); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                <i data-lucide="file-text" style="width: 22px; color: var(--accent);"></i>
            </div>
        </div>
        <div style="margin-top: 0.75rem;">
            <svg viewBox="0 0 100 30"
                style="width: 100%; height: 30px; fill: none; stroke: var(--accent); stroke-width: 2; opacity: 0.5;">
                <path d="M0 25 L10 22 L20 28 L30 15 L40 20 L50 8 L60 18 L70 5 L80 15 L90 8 L100 12" />
            </svg>
        </div>
    </div>

    {% if user.role != 'client' %}
    <div class="card stat-card success">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <div class="stat-label">Active Users</div>
                <div class="stat-value" style="color: var(--success);">{{ total_users }}</div>
            </div>
            <div
                style="width: 44px; height: 44px; background: var(--success-subtle); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                <i data-lucide="users" style="width: 22px; color: var(--success);"></i>
            </div>
        </div>
        <div style="margin-top: 1rem; font-size: 0.75rem; color: var(--text-lighter);">
            <span style="color: var(--success);">↑ 2</span> new this month
        </div>
    </div>
    {% endif %}

    <div class="card stat-card warning">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <div class="stat-label">{% if user.role == 'client' %}My Candidates{% else %}Total Candidates{% endif %}
                </div>
                <div class="stat-value" style="color: var(--warning);">{{ total_candidates }}</div>
            </div>
            <div
                style="width: 44px; height: 44px; background: var(--warning-subtle); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                <i data-lucide="user-check" style="width: 22px; color: var(--warning);"></i>
            </div>
        </div>
        <div style="margin-top: 1rem; font-size: 0.75rem; color: var(--text-lighter);">
            All available for hire
        </div>
    </div>
</div>

<!-- Recent Activity -->
<div class="card animate-in delay-2">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h2 style="margin: 0; display: flex; align-items: center; gap: 0.5rem;">
            <i data-lucide="activity" style="width: 20px; color: var(--accent);"></i> Recent Activity
        </h2>
        <button class="btn btn-outline" style="font-size: 0.8125rem;">
            <i data-lucide="external-link" style="width: 14px;"></i> View All
        </button>
    </div>

    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
        {% for log in logs %}
        <div class="animate-in"
            style="--delay: {{ loop.index * 0.06 }}s; animation-delay: var(--delay); padding: 1.125rem; background: var(--glass); border: 1px solid transparent; border-radius: var(--radius); display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; cursor: default;"
            onmouseover="this.style.borderColor='var(--border)'; this.style.background='var(--glass-strong)'"
            onmouseout="this.style.borderColor='transparent'; this.style.background='var(--glass)'">
            <div style="display: flex; align-items: center; gap: 1rem;">
                {% set action_cat = 'view' if 'VIEW' in log.action else 'login' if 'LOGIN' in log.action else 'logout'
                if 'LOGOUT' in log.action else 'other' %}
                <div class="activity-icon-box" data-category="{{ action_cat }}"
                    style="width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                    <i data-lucide="{{ 'eye' if 'VIEW' in log.action else 'log-in' if 'LOGIN' in log.action else 'log-out' if 'LOGOUT' in log.action else 'zap' }}"
                        style="width: 16px;"></i>
                </div>


                <div>
                    <div style="font-weight: 600; font-size: 0.875rem; margin-bottom: 0.125rem;">
                        {{ log.action | replace('_', ' ') | title }}
                    </div>
                    <div style="font-size: 0.75rem; color: var(--text-lighter);">
                        {{ log.username }}
                        {% if log.candidate_name %} • {{ log.candidate_name }}{% endif %}
                    </div>

                </div>
            </div>
            <div style="text-align: right;">
                <div style="font-size: 0.8125rem; font-weight: 500; color: var(--accent);">{{ log.timestamp | timesince
                    }}</div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}